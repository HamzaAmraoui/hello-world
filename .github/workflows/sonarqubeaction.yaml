name: SonarQube Analysis

on:
  push:
    branches:
      - main  # Cambia esta rama si es necesario
  pull_request:
    branches:
      - main  # Cambia esta rama si es necesario

jobs:
  sonar:
    runs-on: ubuntu-latest

    steps:
    # Paso 1: Checkout del código
    - name: Check out code
      uses: actions/checkout@v2

    # Paso 2: Configurar JDK 11 (puedes cambiar la versión de Java si es necesario)
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        distribution: "temurin"
        java-version: '11'

    # Paso 3: Instalar dependencias (puedes cambiar Maven a Gradle o npm si lo usas)
    - name: Build with Maven
      run: mvn clean install -DskipTests

    # Paso 4: Ejecutar SonarQube Scanner
    - name: Run SonarQube scanner
      uses: SonarSource/sonarcloud-github-action@v2
      env:
        sonar-token: ${{ secrets.SONAR_TOKEN }}  # Aquí usas el token de SonarQube o SonarCloud

    # Paso 5: (Opcional) Subir los resultados a SonarQube
    - name: Upload SonarQube results
      run: |
        curl -X POST -u ${{ secrets.SONAR_TOKEN }} "http://localhost:9000/sonarqube"
